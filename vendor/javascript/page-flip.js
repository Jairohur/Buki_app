// page-flip@2.0.7 downloaded from https://ga.jspm.io/npm:page-flip@2.0.7/dist/js/page-flip.browser.js

var m={};!function(f,y){y(m)}(0,(function(m){class e{constructor(m,f){this.state={angle:0,area:[],position:{x:0,y:0},hardAngle:0,hardDrawingAngle:0},this.createdDensity=f,this.nowDrawingDensity=this.createdDensity,this.render=m}setDensity(m){this.createdDensity=m,this.nowDrawingDensity=m}setDrawingDensity(m){this.nowDrawingDensity=m}setPosition(m){this.state.position=m}setAngle(m){this.state.angle=m}setArea(m){this.state.area=m}setHardDrawingAngle(m){this.state.hardDrawingAngle=m}setHardAngle(m){this.state.hardAngle=m,this.state.hardDrawingAngle=m}setOrientation(m){this.orientation=m}getDrawingDensity(){return this.nowDrawingDensity}getDensity(){return this.createdDensity}getHardAngle(){return this.state.hardAngle}}class i extends e{constructor(m,f,y){super(m,y),this.image=null,this.isLoad=!1,this.loadingAngle=0,this.image=new Image,this.image.src=f}draw(m){const f=this.render.getContext(),y=this.render.convertToGlobal(this.state.position),P=this.render.getRect().pageWidth,S=this.render.getRect().height;f.save(),f.translate(y.x,y.y),f.beginPath();for(let m of this.state.area)null!==m&&(m=this.render.convertToGlobal(m),f.lineTo(m.x-y.x,m.y-y.y));f.rotate(this.state.angle),f.clip(),this.isLoad?f.drawImage(this.image,0,0,P,S):this.drawLoader(f,{x:0,y:0},P,S),f.restore()}simpleDraw(m){const f=this.render.getRect(),y=this.render.getContext(),P=f.pageWidth,S=f.height,b=1===m?f.left+f.pageWidth:f.left,v=f.top;this.isLoad?y.drawImage(this.image,b,v,P,S):this.drawLoader(y,{x:b,y:v},P,S)}drawLoader(m,f,y,P){m.beginPath(),m.strokeStyle="rgb(200, 200, 200)",m.fillStyle="rgb(255, 255, 255)",m.lineWidth=1,m.rect(f.x+1,f.y+1,y-1,P-1),m.stroke(),m.fill();const S={x:f.x+y/2,y:f.y+P/2};m.beginPath(),m.lineWidth=10,m.arc(S.x,S.y,20,this.loadingAngle,3*Math.PI/2+this.loadingAngle),m.stroke(),m.closePath(),this.loadingAngle+=.07,this.loadingAngle>=2*Math.PI&&(this.loadingAngle=0)}load(){this.isLoad||(this.image.onload=()=>{this.isLoad=!0})}newTemporaryCopy(){return this}getTemporaryCopy(){return this}hideTemporaryCopy(){}}class s{constructor(m,f){this.pages=[],this.currentPageIndex=0,this.currentSpreadIndex=0,this.landscapeSpread=[],this.portraitSpread=[],this.render=f,this.app=m,this.currentPageIndex=0,this.isShowCover=this.app.getSettings().showCover}destroy(){this.pages=[]}createSpread(){this.landscapeSpread=[],this.portraitSpread=[];for(let m=0;m<this.pages.length;m++)this.portraitSpread.push([m]);let m=0;this.isShowCover&&(this.pages[0].setDensity("hard"),this.landscapeSpread.push([m]),m++);for(let f=m;f<this.pages.length;f+=2)f<this.pages.length-1?this.landscapeSpread.push([f,f+1]):(this.landscapeSpread.push([f]),this.pages[f].setDensity("hard"))}getSpread(){return"landscape"===this.render.getOrientation()?this.landscapeSpread:this.portraitSpread}getSpreadIndexByPage(m){const f=this.getSpread();for(let y=0;y<f.length;y++)if(m===f[y][0]||m===f[y][1])return y;return null}getPageCount(){return this.pages.length}getPages(){return this.pages}getPage(m){if(m>=0&&m<this.pages.length)return this.pages[m];throw new Error("Invalid page number")}nextBy(m){const f=this.pages.indexOf(m);return f<this.pages.length-1?this.pages[f+1]:null}prevBy(m){const f=this.pages.indexOf(m);return f>0?this.pages[f-1]:null}getFlippingPage(m){const f=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===m?this.pages[f].newTemporaryCopy():this.pages[f-1];{const y=0===m?this.getSpread()[f+1]:this.getSpread()[f-1];return 1===y.length||0===m?this.pages[y[0]]:this.pages[y[1]]}}getBottomPage(m){const f=this.currentSpreadIndex;if("portrait"===this.render.getOrientation())return 0===m?this.pages[f+1]:this.pages[f-1];{const y=0===m?this.getSpread()[f+1]:this.getSpread()[f-1];return 1===y.length?this.pages[y[0]]:0===m?this.pages[y[1]]:this.pages[y[0]]}}showNext(){this.currentSpreadIndex<this.getSpread().length&&(this.currentSpreadIndex++,this.showSpread())}showPrev(){this.currentSpreadIndex>0&&(this.currentSpreadIndex--,this.showSpread())}getCurrentPageIndex(){return this.currentPageIndex}show(m=null){if(null===m&&(m=this.currentPageIndex),m<0||m>=this.pages.length)return;const f=this.getSpreadIndexByPage(m);null!==f&&(this.currentSpreadIndex=f,this.showSpread())}getCurrentSpreadIndex(){return this.currentSpreadIndex}setCurrentSpreadIndex(m){if(!(m>=0&&m<this.getSpread().length))throw new Error("Invalid page");this.currentSpreadIndex=m}showSpread(){const m=this.getSpread()[this.currentSpreadIndex];2===m.length?(this.render.setLeftPage(this.pages[m[0]]),this.render.setRightPage(this.pages[m[1]])):"landscape"===this.render.getOrientation()&&m[0]===this.pages.length-1?(this.render.setLeftPage(this.pages[m[0]]),this.render.setRightPage(null)):(this.render.setLeftPage(null),this.render.setRightPage(this.pages[m[0]])),this.currentPageIndex=m[0],this.app.updatePageIndex(this.currentPageIndex)}}class n extends s{constructor(m,f,y){super(m,f),this.imagesHref=y}load(){for(const m of this.imagesHref){const f=new i(this.render,m,"soft");f.load(),this.pages.push(f)}this.createSpread()}}class h{static GetDistanceBetweenTwoPoint(m,f){return null===m||null===f?1/0:Math.sqrt(Math.pow(f.x-m.x,2)+Math.pow(f.y-m.y,2))}static GetSegmentLength(m){return h.GetDistanceBetweenTwoPoint(m[0],m[1])}static GetAngleBetweenTwoLine(m,f){const y=m[0].y-m[1].y,P=f[0].y-f[1].y,S=m[1].x-m[0].x,b=f[1].x-f[0].x;return Math.acos((y*P+S*b)/(Math.sqrt(y*y+S*S)*Math.sqrt(P*P+b*b)))}static PointInRect(m,f){return null===f?null:f.x>=m.left&&f.x<=m.width+m.left&&f.y>=m.top&&f.y<=m.top+m.height?f:null}static GetRotatedPoint(m,f,y){return{x:m.x*Math.cos(y)+m.y*Math.sin(y)+f.x,y:m.y*Math.cos(y)-m.x*Math.sin(y)+f.y}}static LimitPointToCircle(m,f,y){if(h.GetDistanceBetweenTwoPoint(m,y)<=f)return y;const P=m.x,S=m.y,b=y.x,v=y.y;let I=Math.sqrt(Math.pow(f,2)*Math.pow(P-b,2)/(Math.pow(P-b,2)+Math.pow(S-v,2)))+P;y.x<0&&(I*=-1);let T=(I-P)*(S-v)/(P-b)+S;return P-b+S===0&&(T=f),{x:I,y:T}}static GetIntersectBetweenTwoSegment(m,f,y){return h.PointInRect(m,h.GetIntersectBeetwenTwoLine(f,y))}static GetIntersectBeetwenTwoLine(m,f){const y=m[0].y-m[1].y,P=f[0].y-f[1].y,S=m[1].x-m[0].x,b=f[1].x-f[0].x,v=m[0].x*m[1].y-m[1].x*m[0].y,I=f[0].x*f[1].y-f[1].x*f[0].y,T=y*I-P*v,C=S*I-b*v,D=-(v*b-I*S)/(y*b-P*S),R=-(y*I-P*v)/(y*b-P*S);if(isFinite(D)&&isFinite(R))return{x:D,y:R};if(Math.abs(T-C)<.1)throw new Error("Segment included");return null}static GetCordsFromTwoPoint(m,f){const y=Math.abs(m.x-f.x),P=Math.abs(m.y-f.y),S=Math.max(y,P),b=[m];function r(m,f,y,P,S){return f>m?m+S*(y/P):f<m?m-S*(y/P):m}for(let v=1;v<=S;v+=1)b.push({x:r(m.x,f.x,y,S,v),y:r(m.y,f.y,P,S,v)});return b}}class r extends e{constructor(m,f,y){super(m,y),this.copiedElement=null,this.temporaryCopy=null,this.isLoad=!1,this.element=f,this.element.classList.add("stf__item"),this.element.classList.add("--"+y)}newTemporaryCopy(){return"hard"===this.nowDrawingDensity?this:(null===this.temporaryCopy&&(this.copiedElement=this.element.cloneNode(!0),this.element.parentElement.appendChild(this.copiedElement),this.temporaryCopy=new r(this.render,this.copiedElement,this.nowDrawingDensity)),this.getTemporaryCopy())}getTemporaryCopy(){return this.temporaryCopy}hideTemporaryCopy(){null!==this.temporaryCopy&&(this.copiedElement.remove(),this.copiedElement=null,this.temporaryCopy=null)}draw(m){const f=m||this.nowDrawingDensity,y=this.render.convertToGlobal(this.state.position),P=this.render.getRect().pageWidth,S=this.render.getRect().height;this.element.classList.remove("--simple");const b=`\n            display: block;\n            z-index: ${this.element.style.zIndex};\n            left: 0;\n            top: 0;\n            width: ${P}px;\n            height: ${S}px;\n        `;"hard"===f?this.drawHard(b):this.drawSoft(y,b)}drawHard(m=""){const f=this.render.getRect().left+this.render.getRect().width/2,y=this.state.hardDrawingAngle,P=m+"\n                backface-visibility: hidden;\n                -webkit-backface-visibility: hidden;\n                clip-path: none;\n                -webkit-clip-path: none;\n            "+(0===this.orientation?`transform-origin: ${this.render.getRect().pageWidth}px 0; \n                   transform: translate3d(0, 0, 0) rotateY(${y}deg);`:`transform-origin: 0 0; \n                   transform: translate3d(${f}px, 0, 0) rotateY(${y}deg);`);this.element.style.cssText=P}drawSoft(m,f=""){let y="polygon( ";for(const m of this.state.area)if(null!==m){let f=1===this.render.getDirection()?{x:-m.x+this.state.position.x,y:m.y-this.state.position.y}:{x:m.x-this.state.position.x,y:m.y-this.state.position.y};f=h.GetRotatedPoint(f,{x:0,y:0},this.state.angle),y+=f.x+"px "+f.y+"px, "}y=y.slice(0,-2),y+=")";const P=f+`transform-origin: 0 0; clip-path: ${y}; -webkit-clip-path: ${y};`+(this.render.isSafari()&&0===this.state.angle?`transform: translate(${m.x}px, ${m.y}px);`:`transform: translate3d(${m.x}px, ${m.y}px, 0) rotate(${this.state.angle}rad);`);this.element.style.cssText=P}simpleDraw(m){const f=this.render.getRect(),y=f.pageWidth,P=f.height,S=1===m?f.left+f.pageWidth:f.left,b=f.top;this.element.classList.add("--simple"),this.element.style.cssText=`\n            position: absolute; \n            display: block; \n            height: ${P}px; \n            left: ${S}px; \n            top: ${b}px; \n            width: ${y}px; \n            z-index: ${this.render.getSettings().startZIndex+1};`}getElement(){return this.element}load(){this.isLoad=!0}setOrientation(m){super.setOrientation(m),this.element.classList.remove("--left","--right"),this.element.classList.add(1===m?"--right":"--left")}setDrawingDensity(m){this.element.classList.remove("--soft","--hard"),this.element.classList.add("--"+m),super.setDrawingDensity(m)}}class o extends s{constructor(m,f,y,P){super(m,f),this.element=y,this.pagesElement=P}load(){for(const m of this.pagesElement){const f=new r(this.render,m,"hard"===m.dataset.density?"hard":"soft");f.load(),this.pages.push(f)}this.createSpread()}}class a{constructor(m,f,y,P){this.direction=m,this.corner=f,this.topIntersectPoint=null,this.sideIntersectPoint=null,this.bottomIntersectPoint=null,this.pageWidth=parseInt(y,10),this.pageHeight=parseInt(P,10)}calc(m){try{return this.position=this.calcAngleAndPosition(m),this.calculateIntersectPoint(this.position),!0}catch(m){return!1}}getFlippingClipArea(){const m=[];let f=!1;return m.push(this.rect.topLeft),m.push(this.topIntersectPoint),null===this.sideIntersectPoint?f=!0:(m.push(this.sideIntersectPoint),null===this.bottomIntersectPoint&&(f=!1)),m.push(this.bottomIntersectPoint),(f||"bottom"===this.corner)&&m.push(this.rect.bottomLeft),m}getBottomClipArea(){const m=[];return m.push(this.topIntersectPoint),"top"===this.corner?m.push({x:this.pageWidth,y:0}):(null!==this.topIntersectPoint&&m.push({x:this.pageWidth,y:0}),m.push({x:this.pageWidth,y:this.pageHeight})),null!==this.sideIntersectPoint?h.GetDistanceBetweenTwoPoint(this.sideIntersectPoint,this.topIntersectPoint)>=10&&m.push(this.sideIntersectPoint):"top"===this.corner&&m.push({x:this.pageWidth,y:this.pageHeight}),m.push(this.bottomIntersectPoint),m.push(this.topIntersectPoint),m}getAngle(){return 0===this.direction?-this.angle:this.angle}getRect(){return this.rect}getPosition(){return this.position}getActiveCorner(){return 0===this.direction?this.rect.topLeft:this.rect.topRight}getDirection(){return this.direction}getFlippingProgress(){return Math.abs((this.position.x-this.pageWidth)/(2*this.pageWidth)*100)}getCorner(){return this.corner}getBottomPagePosition(){return 1===this.direction?{x:this.pageWidth,y:0}:{x:0,y:0}}getShadowStartPoint(){return"top"===this.corner?this.topIntersectPoint:null!==this.sideIntersectPoint?this.sideIntersectPoint:this.topIntersectPoint}getShadowAngle(){const m=h.GetAngleBetweenTwoLine(this.getSegmentToShadowLine(),[{x:0,y:0},{x:this.pageWidth,y:0}]);return 0===this.direction?m:Math.PI-m}calcAngleAndPosition(m){let f=m;if(this.updateAngleAndGeometry(f),f="top"===this.corner?this.checkPositionAtCenterLine(f,{x:0,y:0},{x:0,y:this.pageHeight}):this.checkPositionAtCenterLine(f,{x:0,y:this.pageHeight},{x:0,y:0}),Math.abs(f.x-this.pageWidth)<1&&Math.abs(f.y)<1)throw new Error("Point is too small");return f}updateAngleAndGeometry(m){this.angle=this.calculateAngle(m),this.rect=this.getPageRect(m)}calculateAngle(m){const f=this.pageWidth-m.x+1,y="bottom"===this.corner?this.pageHeight-m.y:m.y;let P=2*Math.acos(f/Math.sqrt(y*y+f*f));y<0&&(P=-P);const S=Math.PI-P;if(!isFinite(P)||S>=0&&S<.003)throw new Error("The G point is too small");return"bottom"===this.corner&&(P=-P),P}getPageRect(m){return"top"===this.corner?this.getRectFromBasePoint([{x:0,y:0},{x:this.pageWidth,y:0},{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}],m):this.getRectFromBasePoint([{x:0,y:-this.pageHeight},{x:this.pageWidth,y:-this.pageHeight},{x:0,y:0},{x:this.pageWidth,y:0}],m)}getRectFromBasePoint(m,f){return{topLeft:this.getRotatedPoint(m[0],f),topRight:this.getRotatedPoint(m[1],f),bottomLeft:this.getRotatedPoint(m[2],f),bottomRight:this.getRotatedPoint(m[3],f)}}getRotatedPoint(m,f){return{x:m.x*Math.cos(this.angle)+m.y*Math.sin(this.angle)+f.x,y:m.y*Math.cos(this.angle)-m.x*Math.sin(this.angle)+f.y}}calculateIntersectPoint(m){const f={left:-1,top:-1,width:this.pageWidth+2,height:this.pageHeight+2};"top"===this.corner?(this.topIntersectPoint=h.GetIntersectBetweenTwoSegment(f,[m,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=h.GetIntersectBetweenTwoSegment(f,[m,this.rect.bottomLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=h.GetIntersectBetweenTwoSegment(f,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}])):(this.topIntersectPoint=h.GetIntersectBetweenTwoSegment(f,[this.rect.topLeft,this.rect.topRight],[{x:0,y:0},{x:this.pageWidth,y:0}]),this.sideIntersectPoint=h.GetIntersectBetweenTwoSegment(f,[m,this.rect.topLeft],[{x:this.pageWidth,y:0},{x:this.pageWidth,y:this.pageHeight}]),this.bottomIntersectPoint=h.GetIntersectBetweenTwoSegment(f,[this.rect.bottomLeft,this.rect.bottomRight],[{x:0,y:this.pageHeight},{x:this.pageWidth,y:this.pageHeight}]))}checkPositionAtCenterLine(m,f,y){let P=m;const S=h.LimitPointToCircle(f,this.pageWidth,P);P!==S&&(P=S,this.updateAngleAndGeometry(P));const b=Math.sqrt(Math.pow(this.pageWidth,2)+Math.pow(this.pageHeight,2));let v=this.rect.bottomRight,I=this.rect.topLeft;if("bottom"===this.corner&&(v=this.rect.topRight,I=this.rect.bottomLeft),v.x<=0){const m=h.LimitPointToCircle(y,b,I);m!==P&&(P=m,this.updateAngleAndGeometry(P))}return P}getSegmentToShadowLine(){const m=this.getShadowStartPoint();return[m,m!==this.sideIntersectPoint&&null!==this.sideIntersectPoint?this.sideIntersectPoint:this.bottomIntersectPoint]}}class g{constructor(m,f){this.flippingPage=null,this.bottomPage=null,this.calc=null,this.state="read",this.render=m,this.app=f}fold(m){this.setState("user_fold"),null===this.calc&&this.start(m),this.do(this.render.convertToPage(m))}flip(m){if(this.app.getSettings().disableFlipByClick&&!this.isPointOnCorners(m))return;if(null!==this.calc&&this.render.finishAnimation(),!this.start(m))return;const f=this.getBoundsRect();this.setState("flipping");const y=f.height/10,P="bottom"===this.calc.getCorner()?f.height-y:y,S="bottom"===this.calc.getCorner()?f.height:0;this.calc.calc({x:f.pageWidth-y,y:P}),this.animateFlippingTo({x:f.pageWidth-y,y:P},{x:-f.pageWidth,y:S},!0)}start(m){this.reset();const f=this.render.convertToBook(m),y=this.getBoundsRect(),P=this.getDirectionByPoint(f),S=f.y>=y.height/2?"bottom":"top";if(!this.checkDirection(P))return!1;try{if(this.flippingPage=this.app.getPageCollection().getFlippingPage(P),this.bottomPage=this.app.getPageCollection().getBottomPage(P),"landscape"===this.render.getOrientation())if(1===P){const m=this.app.getPageCollection().nextBy(this.flippingPage);null!==m&&this.flippingPage.getDensity()!==m.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),m.setDrawingDensity("hard"))}else{const m=this.app.getPageCollection().prevBy(this.flippingPage);null!==m&&this.flippingPage.getDensity()!==m.getDensity()&&(this.flippingPage.setDrawingDensity("hard"),m.setDrawingDensity("hard"))}return this.render.setDirection(P),this.calc=new a(P,S,y.pageWidth.toString(10),y.height.toString(10)),!0}catch(m){return!1}}do(m){if(null!==this.calc&&this.calc.calc(m)){const m=this.calc.getFlippingProgress();this.bottomPage.setArea(this.calc.getBottomClipArea()),this.bottomPage.setPosition(this.calc.getBottomPagePosition()),this.bottomPage.setAngle(0),this.bottomPage.setHardAngle(0),this.flippingPage.setArea(this.calc.getFlippingClipArea()),this.flippingPage.setPosition(this.calc.getActiveCorner()),this.flippingPage.setAngle(this.calc.getAngle()),0===this.calc.getDirection()?this.flippingPage.setHardAngle(90*(200-2*m)/100):this.flippingPage.setHardAngle(-90*(200-2*m)/100),this.render.setPageRect(this.calc.getRect()),this.render.setBottomPage(this.bottomPage),this.render.setFlippingPage(this.flippingPage),this.render.setShadowData(this.calc.getShadowStartPoint(),this.calc.getShadowAngle(),m,this.calc.getDirection())}}flipToPage(m,f){const y=this.app.getPageCollection().getCurrentSpreadIndex(),P=this.app.getPageCollection().getSpreadIndexByPage(m);try{P>y&&(this.app.getPageCollection().setCurrentSpreadIndex(P-1),this.flipNext(f)),P<y&&(this.app.getPageCollection().setCurrentSpreadIndex(P+1),this.flipPrev(f))}catch(m){}}flipNext(m){this.flip({x:this.render.getRect().left+2*this.render.getRect().pageWidth-10,y:"top"===m?1:this.render.getRect().height-2})}flipPrev(m){this.flip({x:10,y:"top"===m?1:this.render.getRect().height-2})}stopMove(){if(null===this.calc)return;const m=this.calc.getPosition(),f=this.getBoundsRect(),y="bottom"===this.calc.getCorner()?f.height:0;m.x<=0?this.animateFlippingTo(m,{x:-f.pageWidth,y:y},!0):this.animateFlippingTo(m,{x:f.pageWidth,y:y},!1)}showCorner(m){if(!this.checkState("read","fold_corner"))return;const f=this.getBoundsRect(),y=f.pageWidth;if(this.isPointOnCorners(m))if(null===this.calc){if(!this.start(m))return;this.setState("fold_corner"),this.calc.calc({x:y-1,y:1});const P=50,S="bottom"===this.calc.getCorner()?f.height-1:1,b="bottom"===this.calc.getCorner()?f.height-P:P;this.animateFlippingTo({x:y-1,y:S},{x:y-P,y:b},!1,!1)}else this.do(this.render.convertToPage(m));else this.setState("read"),this.render.finishAnimation(),this.stopMove()}animateFlippingTo(m,f,y,P=!0){const S=h.GetCordsFromTwoPoint(m,f),b=[];for(const m of S)b.push((()=>this.do(m)));const v=this.getAnimationDuration(S.length);this.render.startAnimation(b,v,(()=>{this.calc&&(y&&(1===this.calc.getDirection()?this.app.turnToPrevPage():this.app.turnToNextPage()),P&&(this.render.setBottomPage(null),this.render.setFlippingPage(null),this.render.clearShadow(),this.setState("read"),this.reset()))}))}getCalculation(){return this.calc}getState(){return this.state}setState(m){this.state!==m&&(this.app.updateState(m),this.state=m)}getDirectionByPoint(m){const f=this.getBoundsRect();if("portrait"===this.render.getOrientation()){if(m.x-f.pageWidth<=f.width/5)return 1}else if(m.x<f.width/2)return 1;return 0}getAnimationDuration(m){const f=this.app.getSettings().flippingTime;return m>=1e3?f:m/1e3*f}checkDirection(m){return 0===m?this.app.getCurrentPageIndex()<this.app.getPageCount()-1:this.app.getCurrentPageIndex()>=1}reset(){this.calc=null,this.flippingPage=null,this.bottomPage=null}getBoundsRect(){return this.render.getRect()}checkState(...m){for(const f of m)if(this.state===f)return!0;return!1}isPointOnCorners(m){const f=this.getBoundsRect(),y=f.pageWidth,P=Math.sqrt(Math.pow(y,2)+Math.pow(f.height,2))/5,S=this.render.convertToBook(m);return S.x>0&&S.y>0&&S.x<f.width&&S.y<f.height&&(S.x<P||S.x>f.width-P)&&(S.y<P||S.y>f.height-P)}}class l{constructor(m,f){this.leftPage=null,this.rightPage=null,this.flippingPage=null,this.bottomPage=null,this.direction=null,this.orientation=null,this.shadow=null,this.animation=null,this.pageRect=null,this.boundsRect=null,this.timer=0,this.safari=!1,this.setting=f,this.app=m;const y=new RegExp("Version\\/[\\d\\.]+.*Safari/");this.safari=null!==y.exec(window.navigator.userAgent)}render(m){if(null!==this.animation){const f=Math.round((m-this.animation.startedAt)/this.animation.durationFrame);f<this.animation.frames.length?this.animation.frames[f]():(this.animation.onAnimateEnd(),this.animation=null)}this.timer=m,this.drawFrame()}start(){this.update();const t=m=>{this.render(m),requestAnimationFrame(t)};requestAnimationFrame(t)}startAnimation(m,f,y){this.finishAnimation(),this.animation={frames:m,duration:f,durationFrame:f/m.length,onAnimateEnd:y,startedAt:this.timer}}finishAnimation(){null!==this.animation&&(this.animation.frames[this.animation.frames.length-1](),null!==this.animation.onAnimateEnd&&this.animation.onAnimateEnd()),this.animation=null}update(){this.boundsRect=null;const m=this.calculateBoundsRect();this.orientation!==m&&(this.orientation=m,this.app.updateOrientation(m))}calculateBoundsRect(){let m="landscape";const f=this.getBlockWidth(),y=f/2,P=this.getBlockHeight()/2,S=this.setting.width/this.setting.height;let b=this.setting.width,v=this.setting.height,I=y-b;return"stretch"===this.setting.size?(f<2*this.setting.minWidth&&this.app.getSettings().usePortrait&&(m="portrait"),b="portrait"===m?this.getBlockWidth():this.getBlockWidth()/2,b>this.setting.maxWidth&&(b=this.setting.maxWidth),v=b/S,v>this.getBlockHeight()&&(v=this.getBlockHeight(),b=v*S),I="portrait"===m?y-b/2-b:y-b):f<2*b&&this.app.getSettings().usePortrait&&(m="portrait",I=y-b/2-b),this.boundsRect={left:I,top:P-v/2,width:2*b,height:v,pageWidth:b},m}setShadowData(m,f,y,P){if(!this.app.getSettings().drawShadow)return;const S=100*this.getSettings().maxShadowOpacity;this.shadow={pos:m,angle:f,width:3*this.getRect().pageWidth/4*y/100,opacity:(100-y)*S/100/100,direction:P,progress:2*y}}clearShadow(){this.shadow=null}getBlockWidth(){return this.app.getUI().getDistElement().offsetWidth}getBlockHeight(){return this.app.getUI().getDistElement().offsetHeight}getDirection(){return this.direction}getRect(){return null===this.boundsRect&&this.calculateBoundsRect(),this.boundsRect}getSettings(){return this.app.getSettings()}getOrientation(){return this.orientation}setPageRect(m){this.pageRect=m}setDirection(m){this.direction=m}setRightPage(m){null!==m&&m.setOrientation(1),this.rightPage=m}setLeftPage(m){null!==m&&m.setOrientation(0),this.leftPage=m}setBottomPage(m){null!==m&&m.setOrientation(1===this.direction?0:1),this.bottomPage=m}setFlippingPage(m){null!==m&&m.setOrientation(0===this.direction&&"portrait"!==this.orientation?0:1),this.flippingPage=m}convertToBook(m){const f=this.getRect();return{x:m.x-f.left,y:m.y-f.top}}isSafari(){return this.safari}convertToPage(m,f){f||(f=this.direction);const y=this.getRect();return{x:0===f?m.x-y.left-y.width/2:y.width/2-m.x+y.left,y:m.y-y.top}}convertToGlobal(m,f){if(f||(f=this.direction),null==m)return null;const y=this.getRect();return{x:0===f?m.x+y.left+y.width/2:y.width/2-m.x+y.left,y:m.y+y.top}}convertRectToGlobal(m,f){return f||(f=this.direction),{topLeft:this.convertToGlobal(m.topLeft,f),topRight:this.convertToGlobal(m.topRight,f),bottomLeft:this.convertToGlobal(m.bottomLeft,f),bottomRight:this.convertToGlobal(m.bottomRight,f)}}}class d extends l{constructor(m,f,y){super(m,f),this.canvas=y,this.ctx=y.getContext("2d")}getContext(){return this.ctx}reload(){}drawFrame(){this.clear(),"portrait"!==this.orientation&&null!=this.leftPage&&this.leftPage.simpleDraw(0),null!=this.rightPage&&this.rightPage.simpleDraw(1),null!=this.bottomPage&&this.bottomPage.draw(),this.drawBookShadow(),null!=this.flippingPage&&this.flippingPage.draw(),null!=this.shadow&&(this.drawOuterShadow(),this.drawInnerShadow());const m=this.getRect();"portrait"===this.orientation&&(this.ctx.beginPath(),this.ctx.rect(m.left+m.pageWidth,m.top,m.width,m.height),this.ctx.clip())}drawBookShadow(){const m=this.getRect();this.ctx.save(),this.ctx.beginPath();const f=m.width/20;this.ctx.rect(m.left,m.top,m.width,m.height);const y={x:m.left+m.width/2-f/2,y:0};this.ctx.translate(y.x,y.y);const P=this.ctx.createLinearGradient(0,0,f,0);P.addColorStop(0,"rgba(0, 0, 0, 0)"),P.addColorStop(.4,"rgba(0, 0, 0, 0.2)"),P.addColorStop(.49,"rgba(0, 0, 0, 0.1)"),P.addColorStop(.5,"rgba(0, 0, 0, 0.5)"),P.addColorStop(.51,"rgba(0, 0, 0, 0.4)"),P.addColorStop(1,"rgba(0, 0, 0, 0)"),this.ctx.clip(),this.ctx.fillStyle=P,this.ctx.fillRect(0,0,f,2*m.height),this.ctx.restore()}drawOuterShadow(){const m=this.getRect();this.ctx.save(),this.ctx.beginPath(),this.ctx.rect(m.left,m.top,m.width,m.height);const f=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y});this.ctx.translate(f.x,f.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const y=this.ctx.createLinearGradient(0,0,this.shadow.width,0);0===this.shadow.direction?(this.ctx.translate(0,-100),y.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),y.addColorStop(1,"rgba(0, 0, 0, 0)")):(this.ctx.translate(-this.shadow.width,-100),y.addColorStop(0,"rgba(0, 0, 0, 0)"),y.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")")),this.ctx.clip(),this.ctx.fillStyle=y,this.ctx.fillRect(0,0,this.shadow.width,2*m.height),this.ctx.restore()}drawInnerShadow(){const m=this.getRect();this.ctx.save(),this.ctx.beginPath();const f=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),y=this.convertRectToGlobal(this.pageRect);this.ctx.moveTo(y.topLeft.x,y.topLeft.y),this.ctx.lineTo(y.topRight.x,y.topRight.y),this.ctx.lineTo(y.bottomRight.x,y.bottomRight.y),this.ctx.lineTo(y.bottomLeft.x,y.bottomLeft.y),this.ctx.translate(f.x,f.y),this.ctx.rotate(Math.PI+this.shadow.angle+Math.PI/2);const P=3*this.shadow.width/4,S=this.ctx.createLinearGradient(0,0,P,0);0===this.shadow.direction?(this.ctx.translate(-P,-100),S.addColorStop(1,"rgba(0, 0, 0, "+this.shadow.opacity+")"),S.addColorStop(.9,"rgba(0, 0, 0, 0.05)"),S.addColorStop(.7,"rgba(0, 0, 0, "+this.shadow.opacity+")"),S.addColorStop(0,"rgba(0, 0, 0, 0)")):(this.ctx.translate(0,-100),S.addColorStop(0,"rgba(0, 0, 0, "+this.shadow.opacity+")"),S.addColorStop(.1,"rgba(0, 0, 0, 0.05)"),S.addColorStop(.3,"rgba(0, 0, 0, "+this.shadow.opacity+")"),S.addColorStop(1,"rgba(0, 0, 0, 0)")),this.ctx.clip(),this.ctx.fillStyle=S,this.ctx.fillRect(0,0,P,2*m.height),this.ctx.restore()}clear(){this.ctx.fillStyle="white",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class p{constructor(m,f,y){this.touchPoint=null,this.swipeTimeout=250,this.onResize=()=>{this.update()},this.onMouseDown=m=>{if(this.checkTarget(m.target)){const f=this.getMousePos(m.clientX,m.clientY);this.app.startUserTouch(f),m.preventDefault()}},this.onTouchStart=m=>{if(this.checkTarget(m.target)&&m.changedTouches.length>0){const f=m.changedTouches[0],y=this.getMousePos(f.clientX,f.clientY);this.touchPoint={point:y,time:Date.now()},setTimeout((()=>{null!==this.touchPoint&&this.app.startUserTouch(y)}),this.swipeTimeout),this.app.getSettings().mobileScrollSupport||m.preventDefault()}},this.onMouseUp=m=>{const f=this.getMousePos(m.clientX,m.clientY);this.app.userStop(f)},this.onMouseMove=m=>{const f=this.getMousePos(m.clientX,m.clientY);this.app.userMove(f,!1)},this.onTouchMove=m=>{if(m.changedTouches.length>0){const f=m.changedTouches[0],y=this.getMousePos(f.clientX,f.clientY);this.app.getSettings().mobileScrollSupport?(null!==this.touchPoint&&(Math.abs(this.touchPoint.point.x-y.x)>10||"read"!==this.app.getState())&&m.cancelable&&this.app.userMove(y,!0),"read"!==this.app.getState()&&m.preventDefault()):this.app.userMove(y,!0)}},this.onTouchEnd=m=>{if(m.changedTouches.length>0){const f=m.changedTouches[0],y=this.getMousePos(f.clientX,f.clientY);let P=!1;if(null!==this.touchPoint){const m=y.x-this.touchPoint.point.x,f=Math.abs(y.y-this.touchPoint.point.y);Math.abs(m)>this.swipeDistance&&f<2*this.swipeDistance&&Date.now()-this.touchPoint.time<this.swipeTimeout&&(m>0?this.app.flipPrev(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"):this.app.flipNext(this.touchPoint.point.y<this.app.getRender().getRect().height/2?"top":"bottom"),P=!0),this.touchPoint=null}this.app.userStop(y,P)}},this.parentElement=m,m.classList.add("stf__parent"),m.insertAdjacentHTML("afterbegin",'<div class="stf__wrapper"></div>'),this.wrapper=m.querySelector(".stf__wrapper"),this.app=f;const P=this.app.getSettings().usePortrait?1:2;m.style.minWidth=y.minWidth*P+"px",m.style.minHeight=y.minHeight+"px","fixed"===y.size&&(m.style.minWidth=y.width*P+"px",m.style.minHeight=y.height+"px"),y.autoSize&&(m.style.width="100%",m.style.maxWidth=2*y.maxWidth+"px"),m.style.display="block",window.addEventListener("resize",this.onResize,!1),this.swipeDistance=y.swipeDistance}destroy(){this.app.getSettings().useMouseEvents&&this.removeHandlers(),this.distElement.remove(),this.wrapper.remove()}getDistElement(){return this.distElement}getWrapper(){return this.wrapper}setOrientationStyle(m){this.wrapper.classList.remove("--portrait","--landscape"),"portrait"===m?(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/this.app.getSettings().width*100+"%"),this.wrapper.classList.add("--portrait")):(this.app.getSettings().autoSize&&(this.wrapper.style.paddingBottom=this.app.getSettings().height/(2*this.app.getSettings().width)*100+"%"),this.wrapper.classList.add("--landscape")),this.update()}removeHandlers(){window.removeEventListener("resize",this.onResize),this.distElement.removeEventListener("mousedown",this.onMouseDown),this.distElement.removeEventListener("touchstart",this.onTouchStart),window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("touchend",this.onTouchEnd)}setHandlers(){window.addEventListener("resize",this.onResize,!1),this.app.getSettings().useMouseEvents&&(this.distElement.addEventListener("mousedown",this.onMouseDown),this.distElement.addEventListener("touchstart",this.onTouchStart),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("touchmove",this.onTouchMove,{passive:!this.app.getSettings().mobileScrollSupport}),window.addEventListener("mouseup",this.onMouseUp),window.addEventListener("touchend",this.onTouchEnd))}getMousePos(m,f){const y=this.distElement.getBoundingClientRect();return{x:m-y.left,y:f-y.top}}checkTarget(m){return!this.app.getSettings().clickEventForward||!["a","button"].includes(m.tagName.toLowerCase())}}class c extends p{constructor(m,f,y,P){super(m,f,y),this.wrapper.insertAdjacentHTML("afterbegin",'<div class="stf__block"></div>'),this.distElement=m.querySelector(".stf__block"),this.items=P;for(const m of P)this.distElement.appendChild(m);this.setHandlers()}clear(){for(const m of this.items)this.parentElement.appendChild(m)}updateItems(m){this.removeHandlers(),this.distElement.innerHTML="";for(const f of m)this.distElement.appendChild(f);this.items=m,this.setHandlers()}update(){this.app.getRender().update()}}class u extends p{constructor(m,f,y){super(m,f,y),this.wrapper.innerHTML='<canvas class="stf__canvas"></canvas>',this.canvas=m.querySelectorAll("canvas")[0],this.distElement=this.canvas,this.resizeCanvas(),this.setHandlers()}resizeCanvas(){const m=getComputedStyle(this.canvas),f=parseInt(m.getPropertyValue("width"),10),y=parseInt(m.getPropertyValue("height"),10);this.canvas.width=f,this.canvas.height=y}getCanvas(){return this.canvas}update(){this.resizeCanvas(),this.app.getRender().update()}}class w extends l{constructor(m,f,y){super(m,f),this.outerShadow=null,this.innerShadow=null,this.hardShadow=null,this.hardInnerShadow=null,this.element=y,this.createShadows()}createShadows(){this.element.insertAdjacentHTML("beforeend",'<div class="stf__outerShadow"></div>\n             <div class="stf__innerShadow"></div>\n             <div class="stf__hardShadow"></div>\n             <div class="stf__hardInnerShadow"></div>'),this.outerShadow=this.element.querySelector(".stf__outerShadow"),this.innerShadow=this.element.querySelector(".stf__innerShadow"),this.hardShadow=this.element.querySelector(".stf__hardShadow"),this.hardInnerShadow=this.element.querySelector(".stf__hardInnerShadow")}clearShadow(){super.clearShadow(),this.outerShadow.style.cssText="display: none",this.innerShadow.style.cssText="display: none",this.hardShadow.style.cssText="display: none",this.hardInnerShadow.style.cssText="display: none"}reload(){this.element.querySelector(".stf__outerShadow")||this.createShadows()}drawHardInnerShadow(){const m=this.getRect(),f=this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress;let y=(100-f)*(2.5*m.pageWidth)/100+20;y>m.pageWidth&&(y=m.pageWidth);let P=`\n            display: block;\n            z-index: ${(this.getSettings().startZIndex+5).toString(10)};\n            width: ${y}px;\n            height: ${m.height}px;\n            background: linear-gradient(to right,\n                rgba(0, 0, 0, ${this.shadow.opacity*f/100}) 5%,\n                rgba(0, 0, 0, 0) 100%);\n            left: ${m.left+m.width/2}px;\n            transform-origin: 0 0;\n        `;P+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0);":"transform: translate3d(0, 0, 0) rotateY(180deg);",this.hardInnerShadow.style.cssText=P}drawHardOuterShadow(){const m=this.getRect();let f=(100-(this.shadow.progress>100?200-this.shadow.progress:this.shadow.progress))*(2.5*m.pageWidth)/100+20;f>m.pageWidth&&(f=m.pageWidth);let y=`\n            display: block;\n            z-index: ${(this.getSettings().startZIndex+4).toString(10)};\n            width: ${f}px;\n            height: ${m.height}px;\n            background: linear-gradient(to left, rgba(0, 0, 0, ${this.shadow.opacity}) 5%, rgba(0, 0, 0, 0) 100%);\n            left: ${m.left+m.width/2}px;\n            transform-origin: 0 0;\n        `;y+=0===this.getDirection()&&this.shadow.progress>100||1===this.getDirection()&&this.shadow.progress<=100?"transform: translate3d(0, 0, 0) rotateY(180deg);":"transform: translate3d(0, 0, 0);",this.hardShadow.style.cssText=y}drawInnerShadow(){const m=this.getRect(),f=3*this.shadow.width/4,y=0===this.getDirection()?f:0,P=0===this.getDirection()?"to left":"to right",S=this.convertToGlobal(this.shadow.pos),b=this.shadow.angle+3*Math.PI/2,v=[this.pageRect.topLeft,this.pageRect.topRight,this.pageRect.bottomRight,this.pageRect.bottomLeft];let I="polygon( ";for(const m of v){let f=1===this.getDirection()?{x:-m.x+this.shadow.pos.x,y:m.y-this.shadow.pos.y}:{x:m.x-this.shadow.pos.x,y:m.y-this.shadow.pos.y};f=h.GetRotatedPoint(f,{x:y,y:100},b),I+=f.x+"px "+f.y+"px, "}I=I.slice(0,-2),I+=")";const T=`\n            display: block;\n            z-index: ${(this.getSettings().startZIndex+10).toString(10)};\n            width: ${f}px;\n            height: ${2*m.height}px;\n            background: linear-gradient(${P},\n                rgba(0, 0, 0, ${this.shadow.opacity}) 5%,\n                rgba(0, 0, 0, 0.05) 15%,\n                rgba(0, 0, 0, ${this.shadow.opacity}) 35%,\n                rgba(0, 0, 0, 0) 100%);\n            transform-origin: ${y}px 100px;\n            transform: translate3d(${S.x-y}px, ${S.y-100}px, 0) rotate(${b}rad);\n            clip-path: ${I};\n            -webkit-clip-path: ${I};\n        `;this.innerShadow.style.cssText=T}drawOuterShadow(){const m=this.getRect(),f=this.convertToGlobal({x:this.shadow.pos.x,y:this.shadow.pos.y}),y=this.shadow.angle+3*Math.PI/2,P=1===this.getDirection()?this.shadow.width:0,S=0===this.getDirection()?"to right":"to left",b=[{x:0,y:0},{x:m.pageWidth,y:0},{x:m.pageWidth,y:m.height},{x:0,y:m.height}];let v="polygon( ";for(const m of b)if(null!==m){let f=1===this.getDirection()?{x:-m.x+this.shadow.pos.x,y:m.y-this.shadow.pos.y}:{x:m.x-this.shadow.pos.x,y:m.y-this.shadow.pos.y};f=h.GetRotatedPoint(f,{x:P,y:100},y),v+=f.x+"px "+f.y+"px, "}v=v.slice(0,-2),v+=")";const I=`\n            display: block;\n            z-index: ${(this.getSettings().startZIndex+10).toString(10)};\n            width: ${this.shadow.width}px;\n            height: ${2*m.height}px;\n            background: linear-gradient(${S}, rgba(0, 0, 0, ${this.shadow.opacity}), rgba(0, 0, 0, 0));\n            transform-origin: ${P}px 100px;\n            transform: translate3d(${f.x-P}px, ${f.y-100}px, 0) rotate(${y}rad);\n            clip-path: ${v};\n            -webkit-clip-path: ${v};\n        `;this.outerShadow.style.cssText=I}drawLeftPage(){"portrait"!==this.orientation&&null!==this.leftPage&&(1===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.leftPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.leftPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.leftPage.draw(this.flippingPage.getDrawingDensity())):this.leftPage.simpleDraw(0))}drawRightPage(){null!==this.rightPage&&(0===this.direction&&null!==this.flippingPage&&"hard"===this.flippingPage.getDrawingDensity()?(this.rightPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.rightPage.setHardDrawingAngle(180+this.flippingPage.getHardAngle()),this.rightPage.draw(this.flippingPage.getDrawingDensity())):this.rightPage.simpleDraw(1))}drawBottomPage(){if(null===this.bottomPage)return;const m=null!=this.flippingPage?this.flippingPage.getDrawingDensity():null;"portrait"===this.orientation&&1===this.direction||(this.bottomPage.getElement().style.zIndex=(this.getSettings().startZIndex+3).toString(10),this.bottomPage.draw(m))}drawFrame(){this.clear(),this.drawLeftPage(),this.drawRightPage(),this.drawBottomPage(),null!=this.flippingPage&&(this.flippingPage.getElement().style.zIndex=(this.getSettings().startZIndex+5).toString(10),this.flippingPage.draw()),null!=this.shadow&&null!==this.flippingPage&&("soft"===this.flippingPage.getDrawingDensity()?(this.drawOuterShadow(),this.drawInnerShadow()):(this.drawHardOuterShadow(),this.drawHardInnerShadow()))}clear(){for(const m of this.app.getPageCollection().getPages())m!==this.leftPage&&m!==this.rightPage&&m!==this.flippingPage&&m!==this.bottomPage&&(m.getElement().style.cssText="display: none"),m.getTemporaryCopy()!==this.flippingPage&&m.hideTemporaryCopy()}update(){super.update(),null!==this.rightPage&&this.rightPage.setOrientation(1),null!==this.leftPage&&this.leftPage.setOrientation(0)}}class x{constructor(){this._default={startPage:0,size:"fixed",width:0,height:0,minWidth:0,maxWidth:0,minHeight:0,maxHeight:0,drawShadow:!0,flippingTime:1e3,usePortrait:!0,startZIndex:0,autoSize:!0,maxShadowOpacity:1,showCover:!1,mobileScrollSupport:!0,swipeDistance:30,clickEventForward:!0,useMouseEvents:!0,showPageCorners:!0,disableFlipByClick:!1}}getSettings(m){const f=this._default;if(Object.assign(f,m),"stretch"!==f.size&&"fixed"!==f.size)throw new Error('Invalid size type. Available only "fixed" and "stretch" value');if(f.width<=0||f.height<=0)throw new Error("Invalid width or height");if(f.flippingTime<=0)throw new Error("Invalid flipping time");return"stretch"===f.size?(f.minWidth<=0&&(f.minWidth=100),f.maxWidth<f.minWidth&&(f.maxWidth=2e3),f.minHeight<=0&&(f.minHeight=100),f.maxHeight<f.minHeight&&(f.maxHeight=2e3)):(f.minWidth=f.width,f.maxWidth=f.width,f.minHeight=f.height,f.maxHeight=f.height),f}}!function(m,f){void 0===f&&(f={});var y=f.insertAt;if(m&&"undefined"!=typeof document){var P=document.head||document.getElementsByTagName("head")[0],S=document.createElement("style");S.type="text/css","top"===y&&P.firstChild?P.insertBefore(S,P.firstChild):P.appendChild(S),S.styleSheet?S.styleSheet.cssText=m:S.appendChild(document.createTextNode(m))}}(".stf__parent {\n  position: relative;\n  display: block;\n  box-sizing: border-box;\n  transform: translateZ(0);\n\n  -ms-touch-action: pan-y;\n  touch-action: pan-y;\n}\n\n.sft__wrapper {\n  position: relative;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.stf__parent canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  left: 0;\n  top: 0;\n}\n\n.stf__block {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  perspective: 2000px;\n}\n\n.stf__item {\n  display: none;\n  position: absolute;\n  transform-style: preserve-3d;\n}\n\n.stf__outerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__innerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.stf__hardInnerShadow {\n  position: absolute;\n  left: 0;\n  top: 0;\n}");m.PageFlip=class extends class{constructor(){this.events=new Map}on(m,f){return this.events.has(m)?this.events.get(m).push(f):this.events.set(m,[f]),this}off(m){this.events.delete(m)}trigger(m,f,y=null){if(this.events.has(m))for(const P of this.events.get(m))P({data:y,object:f})}}{constructor(m,f){super(),this.isUserTouch=!1,this.isUserMove=!1,this.setting=null,this.pages=null,this.setting=(new x).getSettings(f),this.block=m}destroy(){this.ui.destroy(),this.block.remove()}update(){this.render.update(),this.pages.show()}loadFromImages(m){this.ui=new u(this.block,this,this.setting);const f=this.ui.getCanvas();this.render=new d(this,this.setting,f),this.flipController=new g(this.render,this),this.pages=new n(this,this.render,m),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout((()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})}),1)}loadFromHTML(m){this.ui=new c(this.block,this,this.setting,m),this.render=new w(this,this.setting,this.ui.getDistElement()),this.flipController=new g(this.render,this),this.pages=new o(this,this.render,this.ui.getDistElement(),m),this.pages.load(),this.render.start(),this.pages.show(this.setting.startPage),setTimeout((()=>{this.ui.update(),this.trigger("init",this,{page:this.setting.startPage,mode:this.render.getOrientation()})}),1)}updateFromImages(m){const f=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new n(this,this.render,m),this.pages.load(),this.pages.show(f),this.trigger("update",this,{page:f,mode:this.render.getOrientation()})}updateFromHtml(m){const f=this.pages.getCurrentPageIndex();this.pages.destroy(),this.pages=new o(this,this.render,this.ui.getDistElement(),m),this.pages.load(),this.ui.updateItems(m),this.render.reload(),this.pages.show(f),this.trigger("update",this,{page:f,mode:this.render.getOrientation()})}clear(){this.pages.destroy(),this.ui.clear()}turnToPrevPage(){this.pages.showPrev()}turnToNextPage(){this.pages.showNext()}turnToPage(m){this.pages.show(m)}flipNext(m="top"){this.flipController.flipNext(m)}flipPrev(m="top"){this.flipController.flipPrev(m)}flip(m,f="top"){this.flipController.flipToPage(m,f)}updateState(m){this.trigger("changeState",this,m)}updatePageIndex(m){this.trigger("flip",this,m)}updateOrientation(m){this.ui.setOrientationStyle(m),this.update(),this.trigger("changeOrientation",this,m)}getPageCount(){return this.pages.getPageCount()}getCurrentPageIndex(){return this.pages.getCurrentPageIndex()}getPage(m){return this.pages.getPage(m)}getRender(){return this.render}getFlipController(){return this.flipController}getOrientation(){return this.render.getOrientation()}getBoundsRect(){return this.render.getRect()}getSettings(){return this.setting}getUI(){return this.ui}getState(){return this.flipController.getState()}getPageCollection(){return this.pages}startUserTouch(m){this.mousePosition=m,this.isUserTouch=!0,this.isUserMove=!1}userMove(m,f){this.isUserTouch||f||!this.setting.showPageCorners?this.isUserTouch&&h.GetDistanceBetweenTwoPoint(this.mousePosition,m)>5&&(this.isUserMove=!0,this.flipController.fold(m)):this.flipController.showCorner(m)}userStop(m,f=!1){this.isUserTouch&&(this.isUserTouch=!1,f||(this.isUserMove?this.flipController.stopMove():this.flipController.flip(m)))}},Object.defineProperty(m,"__esModule",{value:!0})}));export default m;

