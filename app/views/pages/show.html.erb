<div class="h-100">
  <!-- Hardcoded Book Page Text -->
  <div style="background-image: url('<%= asset_path("pages-bg.jpg") %>'); background-size: cover;
              background-repeat: no-repeat;
              width: 100vw;
              height: 100vh;
              position: fixed;
              top: 0;
              left: 0;
              z-index: -1;
              background-position: center;"></div>
  <div data-controller="flipbook" class="h-100">
    <!-- All pages must be children of this container! -->
    <div data-flipbook-target="container" class="pageflip-container">
      <% @pages.each_with_index do |page, index| %>
        <div class="my-page bg-white" data-page="<%= index %>">
          <div class="page-content text-center d-flex flex-column justify-content-center">
            <% @languages.each do |language| %>
              <div class="mb-4">
                <h2 id="page-text-<%= language.upcase %>" class="d-inline">
                  <%= page.text[language.upcase] %>
                </h2>
                <button
                  class="btn btn-light rounded-pill tts-button"
                  data-text="<%= j page.text[language.upcase] %>"
                  data-language="<%= language.upcase %>"
                  >
                  <i class="fa-solid fa-volume-high"></i>
                </button>
              </div>
            <% end %>
          </div>
          <div class="text-end mt-2">
            Page <%= index + 1 %> of <%= @pages.size %>
          </div>
        </div>
        <div class="my-page text-center bg-white">
          <% if page.photo.attached? %>
            <%= image_tag url_for(page.photo), class: "img-fluid w-100 h-100 object-fit-contain" %>
          <% else %>
            <p>No image available.</p>
          <% end %>
        </div>
      <% end %>
    </div>
    <!-- Buttons -->
    <div class="container-fluid d-flex justify-content-between px-4 my-5">
      <button data-action="flipbook#previous"
          class="rounded-pill btn btn-outline-primary bg-white"
          onmousedown="this.classList.remove('bg-white')"
          onmouseup="this.classList.add('bg-white')"
          onmouseleave="this.classList.add('bg-white')">
        &lt;&lt; Previous page
      </button>
      <button data-action="flipbook#next"
          class="rounded-pill btn btn-outline-primary bg-white"
          onmousedown="this.classList.remove('bg-white')"
          onmouseup="this.classList.add('bg-white')"
          onmouseleave="this.classList.add('bg-white')">
        Next page &gt;&gt;
      </button>
    </div>
  </div>
  <!-- Language Badges -->
  <div class="bg-light border-top px-4 py-2 d-flex justify-content-between align-items-center flex-wrap shadow-sm" style="position: fixed; bottom: 0; left: 0; right: 0; z-index: 1030;">
    <div class="mb-4 d-flex flex-wrap align-items-center gap-3">
      <strong class="me-2 mb-0">Selected Languages:</strong>
      <% if @languages.present? %>
        <% @languages.each do |language| %>
          <span class="tag-badge rounded-pill bg-light border text-dark p-1">
            <%= language_display(language) %>
          </span>
        <% end %>
      <% else %>
        <p class="mb-0">No languages selected.</p>
      <% end %>
    </div>
    <!-- TTS button start -->
    <div class="d-flex gap-2">
      <!-- Return Button -->
      <div class="text-center">
        <%= link_to "Return to Book", book_path(@book),
          class: "rounded-pill btn btn-outline-primary" %>
      </div>
    </div>
  </div>
